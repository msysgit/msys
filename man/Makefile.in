# Makefile for man
# Source: Makefile.in -- processed by configure, to create Makefile.
#
# Copyright (C) 2005, Keith D. Marshall <keithmarshall@users.sourceforge.net>
#
# (Based on an unaccredited original implementation, believed to be the
#  work of John W. Eaton and/or Andries E. Brouwer).
#
# This file is part of the man package.
#
# man is free software; you can redistribute it and/or modify it under the
# terms of the GNU General Public License as published by the Free Software
# Foundation; either version 2, or (at your option) any later version.
#
# man is distributed in the hope that it will be useful, but WITHOUT ANY
# WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
# details.
#
# You should have received a copy of the GNU General Public License along
# with man; see the file COPYING.  If not, write to the Free Software
# Foundation, 51 Franklin St - Fifth Floor, Boston, MA 02110-1301, USA.

# To allow building in a separate build directory,
# (when the "make" program in use supports the VPATH capability),
# set up the srcdir mapping to VPATH.

srcdir = @srcdir@
VPATH = $(srcdir)

# Allow "configure" to choose if message catalogues will be built,
# and subsequently installed.

# (Disabled at present; uncomment to activate)...
# make_messages = @make_messages@
# install_messages = @make_install_messages@

all:	Makefile $(config_sed) source manhtml manpages $(make_messages)
	@echo; echo 'You can now do "make install"'

# On a machine with time before distribution time
# it may be necessary to touch all distributed files

Makefile: Makefile.in configure
	@echo "Please run configure first"
	exit 1

config.sed: configure
	@echo "Please run configure first"
	exit 1

src/Makefile: $(config_sed) src/Makefile.in
	cd src; sed -f ../config.sed Makefile.in > Makefile

man2html/Makefile: $(config_sed) man2html/Makefile.in
	cd man2html; sed -f ../config.sed Makefile.in > Makefile

man/Makefile: $(config_sed) man/Makefile.in
	cd man; sed -f ../config.sed Makefile.in > Makefile

msgs/Makefile: $(config_sed) msgs/Makefile.in
	cd msgs; sed -f ../config.sed Makefile.in > Makefile

makefiles: src/Makefile man2html/Makefile man/Makefile msgs/Makefile

source:	src/Makefile
	cd src; $(MAKE)

manhtml: man2html/Makefile
	cd man2html; $(MAKE)

manpages: man/Makefile
	cd man; $(MAKE) subdirs

messages: gencat/gencat msgs/Makefile
	cd msgs; $(MAKE)

gencat/gencat:
	cd gencat; $(MAKE)

install: install-core $(install_messages) install-done

install-core: src/Makefile man/Makefile man2html/Makefile
	cd src; $(MAKE) install
	cd man2html; $(MAKE) install
	cd man; $(MAKE) installsubdirs

install-messages: msgs/Makefile
	cd msgs; $(MAKE) install

install-done:
	@echo; echo 'Done.'
	@echo 'If you would like to enable a www browser for man pages.'
	@echo '"cd man2html", read README, and perhaps "make install-scripts".'
#	@echo; echo 'Done. In case you want to mount /usr read-only, please'
#	@echo 'install a symlink /usr/man/whatis -> /var/catman/whatis,'
#	@echo '(or to whatever cat page location is appropriate).'

clean: src/Makefile man/Makefile msgs/Makefile man2html/Makefile
	cd src; $(MAKE) clean
	cd man2html; $(MAKE) clean
	cd man; $(MAKE) cleansubdirs
	cd msgs; $(MAKE) clean
	cd gencat; $(MAKE) clean
	rm -f core *~

spotless distclean reallyclean: clean
	cd src; $(MAKE) spotless
	cd man2html; $(MAKE) spotless
	cd man; $(MAKE) spotlesssubdirs
	cd msgs; $(MAKE) spotless
	cd gencat; $(MAKE) clean
	rm -f config.sed Makefile

DISTR = COPYING README README.HP README.RedHat README.GNU-WIN32 INSTALL \
	Makefile.in configure src man2html man msgs gencat catopen misc

dist:	spotless
	echo man-`grep "static char version" src/version.h | \
		sed -e 's/.*"\([0-9.a-z]*\)".*/\1/'` > .fname
	rm -rf `cat .fname`; mkdir `cat .fname`
	cd `cat .fname`; for i in $(DISTR); do ln -s ../$$i $$i; done
	tar chzf `cat .fname`.tar.gz `cat .fname`
	rm -rf `cat .fname` .fname 
